!function(e,t){var n=t.getElementById("layout"),o=t.getElementById("menu"),r=t.getElementById("menuLink"),i=t.getElementById("main");function a(e,t){for(var n=e.className.split(/\s+/),o=n.length,r=0;r<o;r++)if(n[r]===t){n.splice(r,1);break}o===n.length&&n.push(t),e.className=n.join(" ")}function s(e){var t="active";e.preventDefault(),a(n,t),a(o,t),a(r,t)}r.onclick=function(e){s(e)},i.onclick=function(e){-1!==o.className.indexOf("active")&&s(e)}}(0,this.document),function(e){"use strict";var t,h="undefined"==typeof window&&"undefined"!=typeof global&&"function"==typeof require,m=h?e.require:null,y={protocol:"protocol",host:"hostname",port:"port",path:"pathname",query:"search",hash:"hash"},g={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443};function w(){return h?(t||(t="file://"+(process.platform.match(/^win/i)?"/":"")+m("fs").realpathSync(".")),t):document.location.href}function i(e){return encodeURIComponent(e).replace(/'/g,"%27")}function S(e){return(e=(e=(e=e.replace(/\+/g," ")).replace(/%([ef][0-9a-f])%([89ab][0-9a-f])%([89ab][0-9a-f])/gi,function(e,t,n,o){var r=parseInt(t,16)-224,i=parseInt(n,16)-128;if(0===r&&i<32)return e;var a=(r<<12)+(i<<6)+(parseInt(o,16)-128);return 65535<a?e:String.fromCharCode(a)})).replace(/%([cd][0-9a-f])%([89ab][0-9a-f])/gi,function(e,t,n){var o=parseInt(t,16)-192;if(o<2)return e;var r=parseInt(n,16)-128;return String.fromCharCode((o<<6)+r)})).replace(/%([0-7][0-9a-f])/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})}function v(e){for(var t,n=/([^=&]+)(=([^&]*))?/g;t=n.exec(e);){var o=decodeURIComponent(t[1].replace(/\+/g," ")),r=t[3]?S(t[3]):"";void 0!==this[o]&&null!==this[o]?(this[o]instanceof Array||(this[o]=[this[o]]),this[o].push(r)):this[o]=r}}function $(e,t){!function(e,t,n){var o,r,i;t||(t=w()),h?o=m("url").parse(t):(o=document.createElement("a")).href=t;var a,s,u=(s={path:!0,query:!0,hash:!0},(a=t)&&/^[a-z]+:/.test(a)&&(s.protocol=!0,s.host=!0,/[-a-z0-9]+(\.[-a-z0-9])*:\d+/i.test(a)&&(s.port=!0),/\/\/(.*?)(?::(.*?))?@/.test(a)&&(s.user=!0,s.pass=!0)),s);for(r in i=t.match(/\/\/(.*?)(?::(.*?))?@/)||[],y)u[r]?e[r]=o[y[r]]||"":e[r]="";if(e.protocol=e.protocol.replace(/:$/,""),e.query=e.query.replace(/^\?/,""),e.hash=S(e.hash.replace(/^#/,"")),e.user=S(i[1]||""),e.pass=S(i[2]||""),e.port=g[e.protocol]==e.port||0==e.port?"":e.port,!u.protocol&&/[^/#?]/.test(t.charAt(0))&&(e.path=t.split("?")[0].split("#")[0]),!u.protocol&&n){var d=new $(w().match(/(.*\/)/)[0]),c=d.path.split("/"),l=e.path.split("/"),p=["protocol","user","pass","host","port"],f=p.length;for(c.pop(),r=0;r<f;r++)e[p[r]]=d[p[r]];for(;".."===l[0];)c.pop(),l.shift();e.path=("/"!==t.charAt(0)?c.join("/"):"")+"/"+l.join("/")}e.path=e.path.replace(/^\/{2,}/,"/"),e.paths(e.paths()),e.query=new v(e.query)}(this,e,!t)}v.prototype.toString=function(){var e,t,n="",o=i;for(e in this)if(!(this[e]instanceof Function||null===this[e]))if(this[e]instanceof Array){var r=this[e].length;if(r)for(t=0;t<r;t++)n+=n?"&":"",n+=o(e)+"="+o(this[e][t]);else n+=(n?"&":"")+o(e)+"="}else n+=n?"&":"",n+=o(e)+"="+o(this[e]);return n},$.prototype.clearQuery=function(){for(var e in this.query)this.query[e]instanceof Function||delete this.query[e];return this},$.prototype.queryLength=function(){var e,t=0;for(e in this)this[e]instanceof Function||t++;return t},$.prototype.isEmptyQuery=function(){return 0===this.queryLength()},$.prototype.paths=function(e){var t,n="",o=0;if(e&&e.length&&e+""!==e){for(this.isAbsolute()&&(n="/"),t=e.length;o<t;o++)e[o]=!o&&e[o].match(/^\w:$/)?e[o]:i(e[o]);this.path=n+e.join("/")}for(o=0,t=(e=("/"===this.path.charAt(0)?this.path.slice(1):this.path).split("/")).length;o<t;o++)e[o]=S(e[o]);return e},$.prototype.encode=i,$.prototype.decode=S,$.prototype.isAbsolute=function(){return this.protocol||"/"===this.path.charAt(0)},$.prototype.toString=function(){return(this.protocol&&this.protocol+"://")+(this.user&&i(this.user)+(this.pass&&":"+i(this.pass))+"@")+(this.host&&this.host)+(this.port&&":"+this.port)+(this.path&&this.path)+(this.query.toString()&&"?"+this.query)+(this.hash&&"#"+i(this.hash))},e[e.exports?"exports":"Url"]=$}("undefined"!=typeof module&&module.exports?module:window),function(){"use strict";window.Serious=window.Serious||{},window.Serious.storageKey="%%serious";var i={main:72e5,perEpisode:864e5};window.Serious.storage={save:function(e,t){try{if(!window.localStorage)return void console.log("Cannot access local storage!");Object.assign(e,{timestamp:Date.now()});var n=Serious.storageKey+(t?"-"+e.data.filename:"");window.localStorage.setItem(n,JSON.stringify(e))}catch(e){console.error(e.message)}},load:function(e){try{if(Serious.data&&Serious.data.debug)return null;if(!window.localStorage)return console.log("Cannot access local storage!"),null;var t=Serious.storageKey+(e?"-"+e.file:""),n=JSON.parse(window.localStorage.getItem(t));if(!n)return null;if(!n.timestamp)return null;var o=e?"perEpisode":"main",r=Serious.refetch&&Serious.refetch[o]&&"number"==typeof Serious.refetch[o]&&0<Serious.refetch[o]?Serious.refetch[o]:i[o];return Date.now()-n.timestamp>r?null:(delete n.timestamp,n)}catch(e){return console.error(e.message),null}}}}(),function(){"use strict";function t(e,t){t&&"function"==typeof t&&$(document).on(e,function(e){return t(e)})}window.Serious.on={startup:function(e){t("ready",e)},data:{start:function(e){t(":data-load-start",e)},loaded:function(e){t(":data-load-end",e)}},episode:{start:function(e){t(":episode-load-start",e)},loaded:function(e){t(":episode-load-end",e)}},render:{start:function(e){t(":render-start",e)},finish:function(e){t(":render-end",e)}}},Serious.on.episode.loaded(function(){$(document).ready(function(){$("#overlay").addClass("hide")})}),Serious.on.data.loaded(function(){$(document).ready(function(){$("#overlay").addClass("hide")})})}(),function(){"use strict";var e="on"===$(document.body).attr("data-debug");function d(e,t){$(document).trigger(Object.assign({type:e},t))}function c(e){return e=Number(e),Number.isNaN(e)&&(e=-1),e}function l(e){var t=new Url;t.clearQuery(),t.query.ep=e,window.location.href=t.toString()}window.Serious.render=function(t,e,n){var o,r,i,a,s;if(n||(Serious.data?n=Serious.data:console.error("Could not find story data.")),!(o=e?n.meta.find(function(e){return e.id===t}):n.story.find(function(e){return e.episode===t})))return d(":render-start",{title:"404",content:null}),$("#title").empty().append("404"),$("#subtitle").empty().append("Not found.").show(),void d(":render-end",{title:"404",content:null});function u(n){d(":render-start",n),$(function(){$("#title").empty().append((e?"":n.data.episode+": ")+n.data.title),n.data.subtitle?$("#subtitle").empty().append(n.data.subtitle).show():$("#subtitle").hide(),marked(n.content,{smartypants:!0},function(e,t){$("#content").empty().append(t),d(":render-end",n)})})}d(":episode-load-start",o),$.getJSON((e?"./content/meta/":"./content/episodes/")+o.file,function(e){console.log("loaded from file",e),d(":episode-load-end",o),u(e)}),$("#content").attr("data-view","episode"),$(document.body).attr("data-ep",e?"meta":String(t)),e||($("a.nav").hide(),s=n,a=c(a=t),s.story.some(function(e){var t=c(e.episode);return a+1===t})&&$("#next").show().on("click",function(e){l(Number(t)+1)}),i=n,r=c(r=t),i.story.some(function(e){var t=c(e.episode);return r-1===t})&&$("#prev").show().on("click",function(e){l(Number(t)-1)}))},window.Serious.epLink=l,window.Serious.metaLink=function(e){var t=new Url;t.clearQuery(),t.query.meta=e,window.location.href=t.toString()},window.Serious.emit=d,window.Serious.debug=e}(),function(){"use strict";var f=!1,h=Serious.debug||!1,m=Serious.emit||function(){};function y(e,t){var n=$(document.createElement(e)).addClass(t.classes).append(t.content||"");return delete t.classes,n.attr(t)}var t=y("div",{id:"deck",content:"<h1>Recent Episodes</h1>"});function n(e,t){var n,o;e||(Serious.data?e=Serious.data:console.error("Could not find story data.")),console.log(e),e.story.sort(function(e,t){return Number(e.episode)-Number(t.episode)}),o=t?(n=e.story.reverse()).length>=e.recentMax?e.recentMax:n.length:(n=e.story).length;for(var r=[],i=0;i<o;i++){var a=n[i],s=a.episode,u=y("div",{role:"button",title:"Read more...",classes:"episode-card",name:a.title,"data-goto":s}),d=y("h1",{classes:"episode-title",content:s+": "+a.title}),c=y("h2",{classes:"episode-desc",content:a.description});if(u.append(d,c).on("click",function(e){e.preventDefault(),Serious.epLink(Number($(this).attr("data-goto")))}),i<(t?e.recentsExcerpts:e.episodesExcerpts)){var l=function(n,o){m(":render-start",n),$(function(){n.data.subtitle&&o.children("h1").after(y("h2",{classes:"episode-subtitle",content:n.data.subtitle})),marked(n.content,{smartypants:!0},function(e,t){o.append(y("p",{classes:"episode-preview",content:t})),m(":render-end",n)})})};try{throw u}catch(t){m(":episode-load-start",a);var p=!!f&&Serious.storage.load(a);p?(h&&console.log("loaded from storage",p),m(":episode-load-end",a),l(p,t)):$.getJSON("./content/episodes/"+a.file,function(e){console.log("loaded from file",e),m(":episode-load-end",a),l(e,t),f&&Serious.storage.save(e,!0)}),r.push(t)}}else u.append(y("p",{classes:"episode-preview empty",content:"&hellip;"}));r.push(u)}return r}window.Serious=window.Serious||{},window.Serious.recents=function(e){return t.append(n(e,!0))},window.Serious.list=function(e){return t.empty().append("<h1>Episode List</h1>",n(e))}}(),function(){"use strict";var t=function(o){window.Serious.data=o,Serious.emit(":data-load-end",o);var r=o.displayTitle?o.displayTitle:o.title?o.title:"Untitled",i=o.subtitle||"";document.title=r,$(function(){var e,t,n=new Url;if(n.query&&n.query.ep?window.Serious.render(Number(n.query.ep),!1,o):n.query&&n.query.meta?window.Serious.render(n.query.meta.trim().toLowerCase(),!0,o):($("#title").empty().append(r),i?$("#subtitle").empty().append(r).show():$("#subtitle").hide(),n.query&&n.query.list?$("#content").attr("data-view","ream").append(Serious.list(o)):$("#content").attr("data-view","ream").append(Serious.recents(o))),o.copyright&&"string"==typeof o.copyright&&o.copyright.trim()&&$("#user-copyright").empty().append(o.copyright,"<br />"),1<o.story.length&&$("#last-link").parent("li.pure-menu-item").removeClass("hide"),o.meta&&Array.isArray(o.meta)&&o.meta.length&&o.meta.forEach(function(t,e){var n=t.link.trim();$("#menu .pure-menu-list").append($(document.createElement("li")).addClass("pure-menu-item"+(0===e?" menu-item-divided":"")).append($(document.createElement("a")).addClass("pure-menu-link").attr({href:"#",title:t.label||""}).append(n).on("click",function(e){e.preventDefault(),Serious.metaLink(t.id)})))}),o.links&&Array.isArray(o.links)&&0<o.links.length&&o.links.forEach(function(e,t){e.url&&"string"==typeof e.url&&e.text&&"string"==typeof e.text&&$("#menu .pure-menu-list").append($(document.createElement("li")).addClass("pure-menu-item"+(0===t?" menu-item-divided":"")).append($(document.createElement("a")).addClass("pure-menu-link").attr({href:e.url,target:"_blank",title:e.label||""}).append(e.text)))}),o.disqusShortname&&"string"==typeof o.disqusShortname&&o.disqusShortname.trim()&&"meta"!==$(document.body).attr("data-ep")&&"0"!==$(document.body).attr("data-ep")){$("#title").text().trim().toLowerCase().replace(/[^A-Za-z0-9]*/,"-");e=document,(t=e.createElement("script")).src="https://"+o.disqusShortname.trim()+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t),$("#disqus_thread").removeClass("hide")}})};Serious.emit(":data-load-start");$.getJSON("./content/index.json",function(e){Serious.debug&&console.log("loaded from file",e),t(e)})}(),function(){"use strict";$(function(){$("#first-link").on("click",function(){return window.Serious.epLink(1)}),$("#last-link").on("click",function(){return window.Serious||$(document).on(":data-loaded",function(e){return window.Serious.epLink(e.data.story.length)}),window.Serious.epLink(window.Serious.data.story.length)})})}();