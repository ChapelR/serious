!function(e,t){var o=t.getElementById("layout"),n=t.getElementById("menu"),r=t.getElementById("menuLink"),i=t.getElementById("main");function a(e,t){for(var o=e.className.split(/\s+/),n=o.length,r=0;r<n;r++)if(o[r]===t){o.splice(r,1);break}n===o.length&&o.push(t),e.className=o.join(" ")}function s(e){var t="active";e.preventDefault(),a(o,t),a(n,t),a(r,t)}r.onclick=function(e){s(e)},i.onclick=function(e){-1!==n.className.indexOf("active")&&s(e)}}(0,this.document),function(e){"use strict";var t,h="undefined"==typeof window&&"undefined"!=typeof global&&"function"==typeof require,m=h?e.require:null,y={protocol:"protocol",host:"hostname",port:"port",path:"pathname",query:"search",hash:"hash"},g={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443};function w(){return h?(t||(t="file://"+(process.platform.match(/^win/i)?"/":"")+m("fs").realpathSync(".")),t):document.location.href}function i(e){return encodeURIComponent(e).replace(/'/g,"%27")}function S(e){return(e=(e=(e=e.replace(/\+/g," ")).replace(/%([ef][0-9a-f])%([89ab][0-9a-f])%([89ab][0-9a-f])/gi,function(e,t,o,n){var r=parseInt(t,16)-224,i=parseInt(o,16)-128;if(0===r&&i<32)return e;var a=(r<<12)+(i<<6)+(parseInt(n,16)-128);return 65535<a?e:String.fromCharCode(a)})).replace(/%([cd][0-9a-f])%([89ab][0-9a-f])/gi,function(e,t,o){var n=parseInt(t,16)-192;if(n<2)return e;var r=parseInt(o,16)-128;return String.fromCharCode((n<<6)+r)})).replace(/%([0-7][0-9a-f])/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})}function v(e){for(var t,o=/([^=&]+)(=([^&]*))?/g;t=o.exec(e);){var n=decodeURIComponent(t[1].replace(/\+/g," ")),r=t[3]?S(t[3]):"";void 0!==this[n]&&null!==this[n]?(this[n]instanceof Array||(this[n]=[this[n]]),this[n].push(r)):this[n]=r}}function $(e,t){!function(e,t,o){var n,r,i;t||(t=w()),h?n=m("url").parse(t):(n=document.createElement("a")).href=t;var a,s,u=(s={path:!0,query:!0,hash:!0},(a=t)&&/^[a-z]+:/.test(a)&&(s.protocol=!0,s.host=!0,/[-a-z0-9]+(\.[-a-z0-9])*:\d+/i.test(a)&&(s.port=!0),/\/\/(.*?)(?::(.*?))?@/.test(a)&&(s.user=!0,s.pass=!0)),s);for(r in i=t.match(/\/\/(.*?)(?::(.*?))?@/)||[],y)u[r]?e[r]=n[y[r]]||"":e[r]="";if(e.protocol=e.protocol.replace(/:$/,""),e.query=e.query.replace(/^\?/,""),e.hash=S(e.hash.replace(/^#/,"")),e.user=S(i[1]||""),e.pass=S(i[2]||""),e.port=g[e.protocol]==e.port||0==e.port?"":e.port,!u.protocol&&/[^/#?]/.test(t.charAt(0))&&(e.path=t.split("?")[0].split("#")[0]),!u.protocol&&o){var d=new $(w().match(/(.*\/)/)[0]),l=d.path.split("/"),c=e.path.split("/"),p=["protocol","user","pass","host","port"],f=p.length;for(l.pop(),r=0;r<f;r++)e[p[r]]=d[p[r]];for(;".."===c[0];)l.pop(),c.shift();e.path=("/"!==t.charAt(0)?l.join("/"):"")+"/"+c.join("/")}e.path=e.path.replace(/^\/{2,}/,"/"),e.paths(e.paths()),e.query=new v(e.query)}(this,e,!t)}v.prototype.toString=function(){var e,t,o="",n=i;for(e in this)if(!(this[e]instanceof Function||null===this[e]))if(this[e]instanceof Array){var r=this[e].length;if(r)for(t=0;t<r;t++)o+=o?"&":"",o+=n(e)+"="+n(this[e][t]);else o+=(o?"&":"")+n(e)+"="}else o+=o?"&":"",o+=n(e)+"="+n(this[e]);return o},$.prototype.clearQuery=function(){for(var e in this.query)this.query[e]instanceof Function||delete this.query[e];return this},$.prototype.queryLength=function(){var e,t=0;for(e in this)this[e]instanceof Function||t++;return t},$.prototype.isEmptyQuery=function(){return 0===this.queryLength()},$.prototype.paths=function(e){var t,o="",n=0;if(e&&e.length&&e+""!==e){for(this.isAbsolute()&&(o="/"),t=e.length;n<t;n++)e[n]=!n&&e[n].match(/^\w:$/)?e[n]:i(e[n]);this.path=o+e.join("/")}for(n=0,t=(e=("/"===this.path.charAt(0)?this.path.slice(1):this.path).split("/")).length;n<t;n++)e[n]=S(e[n]);return e},$.prototype.encode=i,$.prototype.decode=S,$.prototype.isAbsolute=function(){return this.protocol||"/"===this.path.charAt(0)},$.prototype.toString=function(){return(this.protocol&&this.protocol+"://")+(this.user&&i(this.user)+(this.pass&&":"+i(this.pass))+"@")+(this.host&&this.host)+(this.port&&":"+this.port)+(this.path&&this.path)+(this.query.toString()&&"?"+this.query)+(this.hash&&"#"+i(this.hash))},e[e.exports?"exports":"Url"]=$}("undefined"!=typeof module&&module.exports?module:window),function(){"use strict";window.Serious=window.Serious||{},window.Serious.storageKey="%%serious";var i={main:72e5,perEpisode:864e5};window.Serious.storage={save:function(e,t){try{if(!window.localStorage)return void console.log("Cannot access local storage!");Object.assign(e,{timestamp:Date.now()});var o=Serious.storageKey+(t?"-"+e.data.filename:"");window.localStorage.setItem(o,JSON.stringify(e))}catch(e){console.error(e.message)}},load:function(e){try{if(Serious.data&&Serious.data.debug)return null;if(!window.localStorage)return console.log("Cannot access local storage!"),null;var t=Serious.storageKey+(e?"-"+e.file:""),o=JSON.parse(window.localStorage.getItem(t));if(!o)return null;if(!o.timestamp)return null;var n=e?"perEpisode":"main",r=Serious.refetch&&Serious.refetch[n]&&"number"==typeof Serious.refetch[n]&&0<Serious.refetch[n]?Serious.refetch[n]:i[n];return Date.now()-o.timestamp>r?null:(delete o.timestamp,o)}catch(e){return console.error(e.message),null}}}}(),function(){"use strict";function t(e,t){t&&"function"==typeof t&&$(document).on(e,function(e){return t(e)})}window.Serious.on={startup:function(e){t("ready",e)},data:{start:function(e){t(":data-load-start",e)},loaded:function(e){t(":data-load-end",e)}},episode:{start:function(e){t(":episode-load-start",e)},loaded:function(e){t(":episode-load-end",e)}},render:{start:function(e){t(":render-start",e)},finish:function(e){t(":render-end",e)}}},Serious.on.episode.loaded(function(){$(document).ready(function(){$("#overlay").addClass("hide")})}),Serious.on.data.loaded(function(){$(document).ready(function(){$("#overlay").addClass("hide")})})}(),function(){"use strict";var a="on"===$(document.body).attr("data-debug");function s(e,t){$(document).trigger(Object.assign({type:e},t))}window.Serious.render=function(t,e,o){var n;if(o||(Serious.data?o=Serious.data:console.error("Could not find story data.")),!(n=e?o.meta.find(function(e){return e.id===t}):o.story.find(function(e){return e.episode===t})))return s(":render-start",{title:"404",content:null}),$("#title").empty().append("404"),$("#subtitle").empty().append("Not found.").show(),void s(":render-end",{title:"404",content:null});function r(o){s(":render-start",o),$(function(){$("#title").empty().append((e?"":o.data.episode+": ")+o.data.title),n.subtitle?$("#subtitle").empty().append(o.data.subtitle).show():$("#subtitle").hide(),marked(o.content,{smartypants:!0},function(e,t){$("#content").empty().append(t),s(":render-end",o)})})}s(":episode-load-start",n);var i=Serious.storage.load(n);i?(a&&console.log("loaded from storage",i),s(":episode-load-end",n),r(i)):$.getJSON((e?"./content/meta/":"./content/episodes/")+n.file,function(e){console.log("loaded from file",e),s(":episode-load-end",n),r(e),Serious.storage.save(e,!0)}),$("#content").attr("data-view","episode"),$(document.body).attr("data-ep",String(t))},window.Serious.epLink=function(e){var t=new Url;t.clearQuery(),t.query.ep=e,window.location.href=t.toString()},window.Serious.metaLink=function(e){var t=new Url;t.clearQuery(),t.query.meta=e,window.location.href=t.toString()},window.Serious.emit=s,window.Serious.debug=a}(),function(){"use strict";var f=Serious.debug||!1,h=Serious.emit||function(){};function m(e,t){var o=$(document.createElement(e)).addClass(t.classes).append(t.content||"");return delete t.classes,o.attr(t)}var t=m("div",{id:"deck",content:"<h1>Recent Episodes</h1>"});function o(e,t){var o,n;e||(Serious.data?e=Serious.data:console.error("Could not find story data.")),console.log(e),e.story.sort(function(e,t){return Number(e.episode)-Number(t.episode)}),n=t?(o=e.story.reverse()).length>=e.recentMax?e.recentMax:o.length:(o=e.story).length;for(var r=[],i=0;i<n;i++){var a=o[i],s=a.episode,u=m("div",{role:"button",title:"Read more...",classes:"episode-card",name:a.title,"data-goto":s}),d=m("h1",{classes:"episode-title",content:s+": "+a.title}),l=m("h2",{classes:"episode-desc",content:a.description});if(u.append(d,l).on("click",function(e){e.preventDefault(),Serious.epLink(Number($(this).attr("data-goto")))}),i<(t?e.recentsExcerpts:e.episodesExcerpts)){var c=function(o,n){h(":render-start",o),$(function(){o.data.subtitle&&n.append(m("h2",{classes:"episode-subtitle",content:o.data.subtitle})),marked(o.content,{smartypants:!0},function(e,t){n.append(m("p",{classes:"episode-preview",content:t})),h(":render-end",o)})})};try{throw u}catch(t){h(":episode-load-start",a);var p=Serious.storage.load(a);p?(f&&console.log("loaded from storage",p),h(":episode-load-end",a),c(p,t)):$.getJSON("./content/episodes/"+a.file,function(e){console.log("loaded from file",e),h(":episode-load-end",a),c(e,t),Serious.storage.save(e,!0)}),r.push(t)}}else u.append(m("p",{classes:"episode-preview empty",content:"&hellip;"}));r.push(u)}return r}window.Serious=window.Serious||{},window.Serious.recents=function(e){return t.append(o(e,!0))},window.Serious.list=function(e){return t.empty().append("<h1>Episode List</h1>",o(e))}}(),function(){"use strict";var t=function(t){window.Serious.data=t,Serious.emit(":data-load-end",t);var o=t.displayTitle?t.displayTitle:t.title?t.title:"Untitled",n=t.subtitle||"";document.title=o,$(function(){var e=new Url;e.query&&e.query.ep?window.Serious.render(Number(e.query.ep),!1,t):e.query&&e.query.meta?window.Serious.render(e.query.meta.trim().toLowerCase(),!0,t):($("#title").empty().append(o),n?$("#subtitle").empty().append(o).show():$("#subtitle").hide(),e.query&&e.query.list?$("#content").attr("data-view","ream").append(Serious.list(t)):$("#content").attr("data-view","ream").append(Serious.recents(t))),1<t.story.length&&$("#last-link").parent("li.pure-menu-item").removeClass("hide"),t.meta&&Array.isArray(t.meta)&&t.meta.length&&t.meta.forEach(function(t,e){var o=t.link.trim();$("#menu .pure-menu-list").append($(document.createElement("li")).addClass("pure-menu-item"+(0===e?" menu-item-divided":"")).append($(document.createElement("a")).addClass("pure-menu-link").attr("href","javascript:void(0)").append(o).on("click",function(e){e.preventDefault(),Serious.metaLink(t.id)})))}),t.links&&Array.isArray(t.links)&&0<t.links.length&&t.links.forEach(function(e,t){e.url&&"string"==typeof e.url&&e.text&&"string"==typeof e.text&&$("#menu .pure-menu-list").append($(document.createElement("li")).addClass("pure-menu-item"+(0===t?" menu-item-divided":"")).append($(document.createElement("a")).addClass("pure-menu-link").attr({href:e.url,target:"_blank"}).append(e.text)))})})};Serious.emit(":data-load-start");var e=Serious.storage.load();e?(Serious.debug&&console.log("loaded from storage",e),t(e)):$.getJSON("./content/index.json",function(e){Serious.debug&&console.log("loaded from file",e),t(e),Serious.storage.save(e)})}(),function(){"use strict";$(function(){$("#first-link").on("click",function(){return window.Serious.epLink(1)}),$("#last-link").on("click",function(){return window.Serious||$(document).on(":data-loaded",function(e){return window.Serious.epLink(e.data.story.length)}),window.Serious.epLink(window.Serious.data.story.length)})})}();